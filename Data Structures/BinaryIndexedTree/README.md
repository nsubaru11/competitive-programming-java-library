# Binary Indexed Tree

## 概要

バイナリインデックスツリー（BIT）、別名フェニック木（Fenwick Tree）は、配列の要素に対する累積和の計算と要素の更新を効率的に行うためのデータ構造です。
特に、要素の更新と区間和の計算が頻繁に必要とされる問題に適しています。

## 実装クラス

### 1. [LongBIT](./src/LongBIT.java) / [IntBIT](./src/IntBIT.java)

- **用途**: `long`型 / `int`型に特化した高速な1次元BIT
- **主な操作**:
	- `apply(int i, v)`: インデックス `i` に `v` を加算 $O(\log N)$
	- `set(int i, v)`: インデックス `i` を `v` に更新 $O(\log N)$
	- `get(int i)`: インデックス `i` の値を取得 $O(1)$
	- `query(int r)`: 閉区間 `[0, r]` の和を計算 $O(\log N)$
	- `query(int l, int r)`: 閉区間 `[l, r]` の和を計算 $O(\log N)$
	- `lowerBound(w)`: 累積和が `w` 以上となる最小のインデックスを検索 $O(\log N)$
- **構築**: `new LongBIT(n, init)` / `new IntBIT(n, init)` で初期値関数から構築可能

### 2. [BIT<T>](./src/BIT.java)

- **用途**: 汎用的な型 `T` と任意の二項演算を扱うBIT
- **特徴**: 逆演算を提供することで、区間和や値の更新にも対応可能

### 3. [LongBIT2D](./src/LongBIT2D.java) / [IntBIT2D](./src/IntBIT2D.java)

- **用途**: 2次元平面上の点加算と矩形領域和を管理
- **主な操作**:
	- `apply(i, j, v)`: $(i, j)$ に `v` を加算 $O(\log H \log W)$
	- `query(i, j)`: 矩形 `[0, i] x [0, j]` の和 $O(\log H \log W)$
	- `query(i1, j1, i2, j2)`: 矩形 `[i1, i2] x [j1, j2]` の和 $O(\log H \log W)$

### 4. [LongRangeBIT](./src/LongRangeBIT.java) / [IntRangeBIT](./src/IntRangeBIT.java)

- **用途**: 区間加算と区間和の取得を共に $O(\log N)$ で行う
- **主な操作**:
	- `apply(l, r, v)`: 区間 `[l, r]` に `v` を一括加算
	- `query(l, r)`: 区間 `[l, r]` の和を取得

## 基本的な考え方

バイナリインデックスツリーは、各ノードが特定の範囲の要素の和を保持する木構造です。この構造は、インデックスのビット表現を利用して効率的に実装されます。

1. **更新操作（update）**:
	- インデックスiの要素を更新する場合、iに関連するすべてのノードを更新
	- 次のノードは `i + (i & -i)` で計算（最下位ビットを加算）

2. **累積和計算（sum）**:
	- インデックス0からiまでの累積和を計算
	- iから始めて、`i - (i & -i)` で前のノードに移動（最下位ビットを減算）

3. **区間和計算（rangeSum）**:
	- `sum(r) - sum(l-1)` で計算

## 応用例

バイナリインデックスツリーは以下のような問題に適用できます：

1. **区間和クエリ**:
	- 配列の特定の区間の和を効率的に計算

2. **点更新・区間和**:
	- 配列の特定の要素を更新し、区間の和を計算する操作が混在する問題

3. **転置数（Inversion Count）**:
	- 配列内の転置数（順序が逆転している要素のペアの数）を効率的に計算

4. **2次元累積和**:
	- 2次元BITを使用して、2次元グリッド上の矩形領域の和を効率的に計算

## セグメント木との比較

| 特性        | バイナリインデックスツリー | セグメント木   |
|-----------|---------------|----------|
| 実装の複雑さ    | シンプル          | やや複雑     |
| メモリ使用量    | O(n)          | O(n)     |
| 更新操作      | O(log n)      | O(log n) |
| 区間和計算     | O(log n)      | O(log n) |
| 区間最小値/最大値 | 非対応           | 対応       |
| 区間の遅延更新   | 非対応           | 対応       |

## 注意事項

- 本ライブラリの実装は 0-indexed での操作を基本としています。
- 区間の最小値や最大値を求める操作には対応していません（そのような操作にはセグメント木が適しています）。
