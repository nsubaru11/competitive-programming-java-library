# Dijkstra 利用ガイド

## 概要

非負重み付きグラフに対して、単一始点最短経路問題を解くDijkstra法の実装クラスです。
専用の遅延ヒープ構築機能を持つインデックス付き優先度キューにより、高速な探索を実現しています。
同一始点での複数回クエリに対応したキャッシュ機構を備えています。

## 特徴

- **遅延ヒープ構築**: 未ソート要素数に応じて最適なヒープ構築アルゴリズムを自動選択（Floyd's heapify vs インクリメンタル構築）
- **キャッシュ機構**: 同一始点からの複数クエリを高速化（再計算を回避）
- **最長経路対応**: コンストラクタで`isMax=true`を指定することで最長経路探索にも対応
- **インデックス付き優先度キュー**: ノードIDとコストを直接管理し、decreaseKey操作を効率化

## 依存関係

- `java.util.Arrays.fill`: 配列初期化
- `java.util.NoSuchElementException`: 空キュー操作時の例外

## 主な機能（メソッド一覧）

### 1. コンストラクタ

| メソッド                                    | 戻り値の型 | 説明                                |
|-----------------------------------------|-------|-----------------------------------|
| `Dijkstra(int v, int e)`                | -     | 頂点数v、辺数eで最短経路探索用に初期化              |
| `Dijkstra(int v, int e, boolean isMax)` | -     | isMax=trueで最長経路、falseで最短経路探索用に初期化 |

### 2. グラフ構築系メソッド

| メソッド                            | 戻り値の型  | 説明                            |
|---------------------------------|--------|-------------------------------|
| `addEdge(int i, int j, long c)` | `void` | 始点i、終点j、重みcの有向辺を追加（キャッシュを無効化） |

### 3. 探索系メソッド

| メソッド                  | 戻り値の型  | 説明                                   |
|-----------------------|--------|--------------------------------------|
| `solve(int i, int j)` | `long` | 始点iから終点jへの最短（最長）経路の重みを返す（到達不可能ならINF） |

### 4. 内部クラス: IndexedPriorityQueue

| メソッド                                            | 戻り値の型     | 説明                              |
|-------------------------------------------------|-----------|---------------------------------|
| `push(int node, long cost)`                     | `void`    | ノードをコスト付きで追加                    |
| `relax(int node, long cost)`                    | `boolean` | Dijkstra法用のrelax操作（コスト改善時にtrue） |
| `peek()`                                        | `long`    | 先頭要素のコストを取得（削除しない）              |
| `pollNode()`                                    | `int`     | 先頭ノードを削除して返す                    |
| `getCostOrDefault(int node, long defaultValue)` | `long`    | ノードのコストを取得（未訪問時はデフォルト値）         |
| `clear()`                                       | `void`    | キューを空にする                        |
| `isEmpty()`                                     | `boolean` | キューが空か判定                        |

## 利用例

### 基本的な最短経路探索

```java
// 頂点数5、辺数7のグラフを構築
Dijkstra dijkstra = new Dijkstra(5, 7);

// 辺を追加（有向グラフ）
dijkstra.addEdge(0, 1, 4);
dijkstra.addEdge(0, 2, 1);
dijkstra.addEdge(2, 1, 2);
dijkstra.addEdge(1, 3, 1);
dijkstra.addEdge(2, 3, 5);
dijkstra.addEdge(3, 4, 3);

// 頂点0から頂点4への最短経路の重みを取得
long dist = dijkstra.solve(0, 4); // 結果: 7 (経路: 0→2→1→3→4)
```

### 最長経路探索（DAGの場合）

```java
// 最長経路モードで初期化
Dijkstra dijkstra = new Dijkstra(4, 5, true);

dijkstra.addEdge(0, 1, 3);
dijkstra.addEdge(0, 2, 2);
dijkstra.addEdge(1, 3, 4);
dijkstra.addEdge(2, 3, 1);

long maxDist = dijkstra.solve(0, 3); // 結果: 7 (経路: 0→1→3)
```

## 注意事項

- **非負重みのみ**: 負の辺重みには対応していない（負閉路がある場合は正しく動作しない）
- **有向グラフ**: 無向グラフを扱う場合は双方向に辺を追加する必要がある
- **辺数上限**: コンストラクタで指定した辺数を超えて`addEdge`を呼ぶと`ArrayIndexOutOfBoundsException`が発生（境界チェック未実装）
- **頂点番号**: 0-indexedで、0 ≤ i < v の範囲を想定
- **キャッシュ無効化**: `addEdge`呼び出し時に自動的にキャッシュがクリアされる
- **最長経路の制約**: 最長経路モード使用時はDAG（有向非巡回グラフ）である必要がある（閉路があると無限ループ）
- **INF値**: 到達不可能な頂点には`Long.MAX_VALUE`が返される

## パフォーマンス特性

- **時間計算量**: O((V + E) log V)
	- V: 頂点数、E: 辺数
	- 遅延ヒープ構築により定数倍が小さい
	- 同一始点での再クエリは O(1)（キャッシュ利用）
- **空間計算量**: O(V + E)
	- 前向き星形式の隣接リスト: O(E)
	- 優先度キュー: O(V)
- **ヒープ構築コスト最適化**:
	- Floyd's heapify: O(N) - 大量要素を一括構築時
	- Incremental siftUp: O(k log N) - 少量要素の逐次追加時
	- 分岐閾値: 厳密計算（k ≤ 100）、近似計算（k > 100）

## バージョン情報

| バージョン番号       | 年月日        | 詳細                         |
|:--------------|:-----------|:---------------------------|
| **バージョン 1.0** | 2025-10-13 | 初版リリース。遅延ヒープ構築機能、キャッシュ機構実装 |

### バージョン管理について

バージョン番号は2桁で管理します：

- 1桁目（メジャーバージョン）: メソッドの追加や機能拡張があった場合に更新
- 2桁目（マイナーバージョン）: 誤字修正、バグ修正、マイクロ高速化などの小さな更新があった場合に更新